services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: cosmeles-backend
    restart: unless-stopped
    environment:
      APP_ENV: prod
      STORAGE_DIR: /app/storage
      DATABASE_URL: sqlite:////app/storage/app.db
      DOUBAO_MODE: mock
    volumes:
      - ./backend/storage:/app/storage
    ports:
      - "127.0.0.1:8000:8000"

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.prod
      args:
        BACKEND_HOST: backend
        BACKEND_PORT: "8000"
    container_name: cosmeles-frontend
    restart: unless-stopped
    environment:
      NODE_ENV: production
      BACKEND_HOST: backend
      BACKEND_PORT: "8000"
      INTERNAL_API_BASE: http://backend:8000
      NEXT_PUBLIC_API_BASE: "http://127.0.0.1:8000"
    ports:
      - "5001:3000"
    depends_on:
      - backend
